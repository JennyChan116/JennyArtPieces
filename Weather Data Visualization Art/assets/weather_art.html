<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hong Kong Weather Art Visualization</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
  <style>
    body { background: #f5f5ff; margin: 0; }
    #desc { position: absolute; left: 40px; top: 40px; font-size: 1.2em; color: #333; font-family: sans-serif; }
    #date { position: absolute; left: 40px; top: 80px; font-size: 1em; color: #666; font-family: sans-serif; }
  /* #tip { position: absolute; left: 40px; top: 120px; font-size: 0.9em; color: #999; font-family: sans-serif; } */
  </style>
</head>
<body>
<div id="desc"></div>
<div id="date"></div>
<div id="info"></div>
<!-- <div id="tip">Use left/right arrow keys to switch date</div> -->
<script>
const weatherData = [
  {date: "2025-09-12", temp_min: 28, temp_max: 34, humidity_min: 55, humidity_max: 85, wind_speed: 2, description: "Fine. Very hot during the day."},
  {date: "2025-09-13", temp_min: 28, temp_max: 34, humidity_min: 55, humidity_max: 85, wind_speed: 2, description: "Fine. Very hot during the day."},
  {date: "2025-09-14", temp_min: 28, temp_max: 34, humidity_min: 55, humidity_max: 85, wind_speed: 2, description: "Mainly fine. Very hot during the day."},
  {date: "2025-09-15", temp_min: 28, temp_max: 32, humidity_min: 65, humidity_max: 90, wind_speed: 3, description: "Sunny periods. A few showers later."},
  {date: "2025-09-16", temp_min: 27, temp_max: 32, humidity_min: 65, humidity_max: 95, wind_speed: 4, description: "Mainly cloudy with a few showers. Sunny intervals during the day."},
  {date: "2025-09-17", temp_min: 28, temp_max: 32, humidity_min: 65, humidity_max: 95, wind_speed: 4, description: "Mainly cloudy with a few showers. Sunny intervals during the day."},
  {date: "2025-09-18", temp_min: 27, temp_max: 31, humidity_min: 70, humidity_max: 95, wind_speed: 4, description: "Mainly cloudy with a few showers and thunderstorms."},
  {date: "2025-09-19", temp_min: 26, temp_max: 30, humidity_min: 70, humidity_max: 95, wind_speed: 3, description: "Mainly cloudy with a few showers and thunderstorms."},
  {date: "2025-09-20", temp_min: 25, temp_max: 29, humidity_min: 75, humidity_max: 98, wind_speed: 3, description: "Mainly cloudy with a few showers and isolated thunderstorms. Sunny intervals during the day."}
];
let dayIdx = 0;
let lastSwitch = 0;
let switchInterval = 90; // About 1.5 seconds at 60fps
function tempToColor(temp) {
  let t = Math.max(25, Math.min(35, temp));
  let ratio = (t - 25) / 10;
  // Color mapping: low temperature = cyan/blue, high temperature = pure red
  let r = Math.floor(60 + 195 * ratio);      // High temp: r=255
  let g = Math.floor(220 - 220 * ratio);     // High temp: g=0
  let b = Math.floor(240 - 240 * ratio);     // High temp: b=0
  return [r, g, b];
}
function setup() {
  createCanvas(900, 700);
  noStroke();
}
function draw() {
  background(245, 245, 255);
  let day = weatherData[dayIdx];
  let temp = (day.temp_min + day.temp_max) / 2;
  let humidity = (day.humidity_min + day.humidity_max) / 2;
  let wind = day.wind_speed;
  let desc = day.description;
  let count = Math.floor(30 + humidity);
  // Ball size and movement amplitude vary by description
  let descLower = desc.toLowerCase();
  let size = 4;
  let amp = 1.0;
  // Enhance visual differentiation for similar but not identical descriptions
  if (descLower.includes('thunderstorm')) {
    size = 10;
    amp = 1.5;
  } else if (descLower.includes('showers') && descLower.includes('cloudy')) {
    size = 8;
    amp = 1.25;
  } else if (descLower.includes('showers')) {
    size = 7;
    amp = 1.15;
  } else if (descLower.includes('cloudy')) {
    size = 6;
    amp = 1.05;
  } else if (descLower.includes('mainly fine')) {
    size = 5;
    amp = 1.0;
  } else if (descLower.includes('fine')) {
    size = 4;
    amp = 0.9;
  }
  let alpha = Math.floor(80 + humidity * 1.5);
  let color = tempToColor(temp);
  let cx = width / 2;
  let cy = height / 2;
  let speed = 1 + wind * 0.7;
  // Draw balls and connect lines
  let ballPositions = [];
  for (let i = 0; i < count; i++) {
  let angle = 2 * Math.PI * i / count + frameCount * 0.004 * speed;
  let groupWave = Math.sin(frameCount * 0.025 + Math.floor(i/5)) * 24 * amp; // Group rhythmic movement
  let individualWave = Math.sin(frameCount * 0.07 + i * 0.8) * 18 * amp; // Individual rhythmic movement
  let baseRadius = 120 + 60 * (i % 3) + 20 * wind;
  let verticalWave = groupWave + individualWave;
  let radius = baseRadius + verticalWave;
  let x = cx + radius * Math.cos(angle);
  let y = cy + radius * Math.sin(angle) + verticalWave * 0.7;
    ballPositions.push({x, y});
  let s = size + Math.floor(2 * Math.random());
  fill(color[0], color[1], color[2], alpha + 80);
  ellipse(x, y, s * 2, s * 2);
  }
  // Draw lines connecting center to each ball
  stroke(color[0], color[1], color[2], 220); // 极大增强饱和度
  strokeWeight(2);
  for (let i = 0; i < ballPositions.length; i++) {
  // The curve control point is offset between the center and the ball, creating a regular curve
    let mx = (cx + ballPositions[i].x) / 2;
    let my = (cy + ballPositions[i].y) / 2;
    let curveOffset = 38 * Math.sin(frameCount * 0.03 + i * 0.7);
    let ctrlX = mx + curveOffset * Math.cos((i / ballPositions.length) * Math.PI * 2 + frameCount * 0.01);
    let ctrlY = my + curveOffset * Math.sin((i / ballPositions.length) * Math.PI * 2 + frameCount * 0.01);
    noFill();
    beginShape();
    vertex(cx, cy);
    quadraticVertex(ctrlX, ctrlY, ballPositions[i].x, ballPositions[i].y);
    endShape();
  }
  noStroke();
  document.getElementById('desc').textContent = day.description;
  document.getElementById('date').textContent = day.date;
  document.getElementById('info').innerHTML =
    `Temp: ${day.temp_min}~${day.temp_max}°C<br>` +
    `Humidity: ${day.humidity_min}~${day.humidity_max}%<br>` +
    `Wind: ${day.wind_speed} m/s`;
  // Auto switch date
  if (frameCount - lastSwitch > switchInterval) {
    dayIdx = (dayIdx + 1) % weatherData.length;
    lastSwitch = frameCount;
  }
}
// function keyPressed() {
//   if (keyCode === RIGHT_ARROW) {
//     dayIdx = (dayIdx + 1) % weatherData.length;
//   } else if (keyCode === LEFT_ARROW) {
//     dayIdx = (dayIdx - 1 + weatherData.length) % weatherData.length;
//   }
// }
</script>
<style>
  #info {
    position: absolute;
    left: 40px;
    top: 120px;
    font-size: 1em;
    color: #444;
    font-family: sans-serif;
    line-height: 1.6em;
  }
</style>
</body>
</html>
